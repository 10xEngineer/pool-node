#!/usr/bin/env ruby

begin
  require '10xengineer-node'
rescue LoadError
  txe_path = File.expand_path('../../lib', __FILE__)

  $:.unshift(txe_path)

  require '10xengineer-node'
end

program :name, "10xeng-node"
program :version, TenxEngineer::Node::VERSION
program :description, "10xEngineer hostnode management toolchain"
program :help_formatter, :compact

$json = false
global_option("-j", "--json", "JSON output (for noninteractive mode)") { $json = true }

default_command :help

# load commands
require '10xengineer-node/lease_commands'

unless File.exists? TenxEngineer::Node::ROOT
  abort "10xEngineer root (#{TenxEngineer::Node::ROOT}) does not exists!"
end

# microcloud client
config = "/etc/10xeng.yaml"
abort "Configuration file does not exists!" unless File.exists?(config)

config = YAML::load(File.open(config))
endpoint = config["hostnode"]["endpoint"]

$microcloud = TenxLabs::Microcloud.new(endpoint)

Commander::Runner.instance.run!

